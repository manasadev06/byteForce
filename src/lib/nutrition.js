export const FOOD_DB = {
  // ─── BREAKFAST ───────────────────────────────────────────────
  "Idli (2 pcs)":           { cal: 140, protein: 4,  carbs: 28, fat: 1,  fiber: 2, meal: "breakfast" },
  "Dosa (1)":               { cal: 168, protein: 4,  carbs: 30, fat: 4,  fiber: 1, meal: "breakfast" },
  "Masala Dosa":            { cal: 230, protein: 5,  carbs: 38, fat: 7,  fiber: 2, meal: "breakfast" },
  "Rava Dosa":              { cal: 195, protein: 4,  carbs: 32, fat: 6,  fiber: 1, meal: "breakfast" },
  "Upma":                   { cal: 200, protein: 5,  carbs: 35, fat: 5,  fiber: 3, meal: "breakfast" },
  "Rava Upma":              { cal: 210, protein: 5,  carbs: 36, fat: 6,  fiber: 2, meal: "breakfast" },
  "Poha":                   { cal: 180, protein: 3,  carbs: 36, fat: 3,  fiber: 2, meal: "breakfast" },
  "Pongal":                 { cal: 220, protein: 6,  carbs: 38, fat: 6,  fiber: 2, meal: "breakfast" },
  "Pongal":             { cal: 240, protein: 7,  carbs: 40, fat: 7,  fiber: 2, meal: "breakfast" },
  "Vada (2)":          { cal: 210, protein: 6,  carbs: 28, fat: 9,  fiber: 2, meal: "breakfast" },
  "Sambar (1 cup)":         { cal: 80,  protein: 4,  carbs: 12, fat: 2,  fiber: 3, meal: "breakfast" },
  "Coconut Chutney":        { cal: 90,  protein: 1,  carbs: 4,  fat: 8,  fiber: 2, meal: "breakfast" },
  "Tomato Chutney":         { cal: 60,  protein: 1,  carbs: 8,  fat: 3,  fiber: 2, meal: "breakfast" },
  "Bread (2 slices)":       { cal: 160, protein: 5,  carbs: 30, fat: 2,  fiber: 2, meal: "breakfast" },
  "Boiled Egg (1)":         { cal: 70,  protein: 6,  carbs: 0,  fat: 5,  fiber: 0, meal: "breakfast" },
  "Omelette (2 eggs)":      { cal: 180, protein: 12, carbs: 2,  fat: 13, fiber: 0, meal: "breakfast" },
  "Banana (1)":             { cal: 90,  protein: 1,  carbs: 23, fat: 0,  fiber: 3, meal: "breakfast" },
  "Milk (1 glass)":         { cal: 120, protein: 6,  carbs: 12, fat: 5,  fiber: 0, meal: "breakfast" },
  "Tea with Milk":          { cal: 50,  protein: 2,  carbs: 6,  fat: 2,  fiber: 0, meal: "breakfast" },
  "Coffee":          { cal: 45,  protein: 1,  carbs: 5,  fat: 2,  fiber: 0, meal: "breakfast" },
  "Cornflakes + Milk":      { cal: 260, protein: 8,  carbs: 45, fat: 5,  fiber: 2, meal: "breakfast" },

  // ─── LUNCH ───────────────────────────────────────────────────
  "Steamed Rice (1 cup)":   { cal: 200, protein: 4,  carbs: 44, fat: 0,  fiber: 1, meal: "lunch" },
  "Sambar Rice":            { cal: 280, protein: 8,  carbs: 52, fat: 4,  fiber: 4, meal: "lunch" },
  "Rasam":                  { cal: 50,  protein: 2,  carbs: 8,  fat: 1,  fiber: 1, meal: "lunch" },
  "Dal Tadka":              { cal: 150, protein: 9,  carbs: 20, fat: 4,  fiber: 5, meal: "lunch" },
  "Rajma":                  { cal: 180, protein: 12, carbs: 25, fat: 3,  fiber: 8, meal: "lunch" },
  "Chole":                  { cal: 190, protein: 10, carbs: 28, fat: 4,  fiber: 7, meal: "lunch" },
  "Kootu (Mixed Veg)":      { cal: 160, protein: 5,  carbs: 22, fat: 6,  fiber: 5, meal: "lunch" },
  "Cabbage fry":      { cal: 100, protein: 3,  carbs: 12, fat: 5,  fiber: 4, meal: "lunch" },
  "Beans fry":        { cal: 90,  protein: 3,  carbs: 10, fat: 4,  fiber: 4, meal: "lunch" },
  "Egg Curry":              { cal: 200, protein: 16, carbs: 6,  fat: 12, fiber: 1, meal: "lunch" },
  "Chicken Curry":          { cal: 280, protein: 24, carbs: 8,  fat: 16, fiber: 1, meal: "lunch" },
  "Fish Curry":             { cal: 220, protein: 22, carbs: 6,  fat: 12, fiber: 0, meal: "lunch" },
  "Paneer Butter Masala":   { cal: 280, protein: 14, carbs: 14, fat: 18, fiber: 2, meal: "lunch" },
  "Curd (100g)":            { cal: 60,  protein: 4,  carbs: 4,  fat: 3,  fiber: 0, meal: "lunch" },
  "Buttermilk (1 glass)":   { cal: 35,  protein: 3,  carbs: 4,  fat: 1,  fiber: 0, meal: "lunch" },
  "Papad (1)":              { cal: 35,  protein: 2,  carbs: 5,  fat: 1,  fiber: 1, meal: "lunch" },
  "Pickle (1 tsp)":         { cal: 15,  protein: 0,  carbs: 2,  fat: 1,  fiber: 0, meal: "lunch" },
  "Appalam":                { cal: 40,  protein: 2,  carbs: 6,  fat: 1,  fiber: 1, meal: "lunch" },

  // ─── DINNER ──────────────────────────────────────────────────
  "Chapati (1)":            { cal: 100, protein: 3,  carbs: 20, fat: 1,  fiber: 2, meal: "dinner" },
  "Roti (1)":               { cal: 100, protein: 3,  carbs: 20, fat: 1,  fiber: 2, meal: "dinner" },
  "Parotta (1)":            { cal: 260, protein: 5,  carbs: 38, fat: 10, fiber: 2, meal: "dinner" },
  "Curd Rice":              { cal: 230, protein: 7,  carbs: 38, fat: 5,  fiber: 1, meal: "dinner" },
  "Lemon Rice":             { cal: 250, protein: 4,  carbs: 46, fat: 6,  fiber: 2, meal: "dinner" },
  "Tamarind Rice":          { cal: 260, protein: 4,  carbs: 48, fat: 6,  fiber: 2, meal: "dinner" },
  "Tomato Rice":            { cal: 240, protein: 4,  carbs: 44, fat: 5,  fiber: 2, meal: "dinner" },
  "Khichdi":                { cal: 210, protein: 8,  carbs: 38, fat: 3,  fiber: 4, meal: "dinner" },
  "Palak Dal":              { cal: 160, protein: 9,  carbs: 22, fat: 4,  fiber: 6, meal: "dinner" },
  "Mixed Veg Curry":        { cal: 140, protein: 4,  carbs: 18, fat: 6,  fiber: 4, meal: "dinner" },
  "Aloo Curry":             { cal: 180, protein: 3,  carbs: 28, fat: 7,  fiber: 3, meal: "dinner" },
  "Brinjal Curry":          { cal: 130, protein: 3,  carbs: 16, fat: 6,  fiber: 4, meal: "dinner" },
  "Paneer Sabzi":           { cal: 220, protein: 14, carbs: 8,  fat: 15, fiber: 2, meal: "dinner" },
  "Egg Bhurji":             { cal: 190, protein: 14, carbs: 4,  fat: 13, fiber: 1, meal: "dinner" },
  "Chicken Gravy":          { cal: 260, protein: 22, carbs: 6,  fat: 15, fiber: 1, meal: "dinner" },
  "Dal Fry":                { cal: 155, protein: 9,  carbs: 22, fat: 4,  fiber: 5, meal: "dinner" },
  "Sambar (dinner)":        { cal: 80,  protein: 4,  carbs: 12, fat: 2,  fiber: 3, meal: "dinner" },
  "Rasam (dinner)":         { cal: 50,  protein: 2,  carbs: 8,  fat: 1,  fiber: 1, meal: "dinner" },
  "Rice (dinner)":  { cal: 200, protein: 4,  carbs: 44, fat: 0,  fiber: 1, meal: "dinner" },
  "Curd (dinner)":          { cal: 60,  protein: 4,  carbs: 4,  fat: 3,  fiber: 0, meal: "dinner" },

  // ─── SNACKS (extra food) ──────────────────────────────────────
  "Roasted Chana":          { cal: 120, protein: 7,  carbs: 18, fat: 2,  fiber: 5, meal: "snack" },
  "Peanuts (handful)":      { cal: 160, protein: 7,  carbs: 6,  fat: 14, fiber: 2, meal: "snack" },
  "Sundal":                 { cal: 130, protein: 6,  carbs: 20, fat: 3,  fiber: 5, meal: "snack" },
  "Murukku (2)":            { cal: 150, protein: 2,  carbs: 20, fat: 7,  fiber: 1, meal: "snack" },
  "Biscuits (4)":           { cal: 200, protein: 2,  carbs: 30, fat: 8,  fiber: 1, meal: "snack" },
  "Banana (snack)":         { cal: 90,  protein: 1,  carbs: 23, fat: 0,  fiber: 3, meal: "snack" },
  "Apple":                  { cal: 80,  protein: 0,  carbs: 21, fat: 0,  fiber: 4, meal: "snack" },
  "Peanut Butter (1 tbsp)": { cal: 90,  protein: 4,  carbs: 3,  fat: 8,  fiber: 1, meal: "snack" },
  "Boiled Egg (snack)":     { cal: 70,  protein: 6,  carbs: 0,  fat: 5,  fiber: 0, meal: "snack" },
  "Buttermilk (snack)":     { cal: 35,  protein: 3,  carbs: 4,  fat: 1,  fiber: 0, meal: "snack" },
  "Tender Coconut":         { cal: 45,  protein: 1,  carbs: 9,  fat: 0,  fiber: 1, meal: "snack" },
  "Maggi (1 pack)":         { cal: 320, protein: 3,  carbs: 45, fat: 13, fiber: 1, meal: "snack" },
  "Bread + Peanut Butter":  { cal: 250, protein: 9,  carbs: 33, fat: 10, fiber: 3, meal: "snack" },
  "Protein Bar":            { cal: 200, protein: 15, carbs: 22, fat: 6,  fiber: 3, meal: "snack" },
}

export const MEAL_TYPES = ["breakfast", "lunch", "dinner", "snack"]

export const getFoodsByMeal = (mealType) =>
  Object.entries(FOOD_DB)
    .filter(([_, v]) => v.meal === mealType)
    .map(([name]) => name)

export const SWAP_SUGGESTIONS = [
  { from: "Maggi (1 pack)",    to: "Boiled Egg (snack) + Bread (2 slices)", reason: "More protein, fewer empty carbs",    saveCost: 3  },
  { from: "Biscuits (4)",      to: "Roasted Chana",                          reason: "3x more protein, better fiber",      saveCost: 5  },
  { from: "Parotta (1)",       to: "Chapati (1)",                            reason: "Lower fat, same carbs",              saveCost: 5  },
  { from: "Aloo Curry",        to: "Paneer Sabzi",                           reason: "5x more protein for muscle building", saveCost: -5 },
  { from: "Lemon Rice",        to: "Curd Rice",                              reason: "Adds protein and probiotics",        saveCost: 0  },
  { from: "Rava Dosa",         to: "Medu Vada (2)",                          reason: "Higher protein breakfast option",    saveCost: 0  },
]

export const calculateNutrition = (foods) => {
  const totals = foods.reduce((acc, food) => {
    // If food object has manual values, use them. Otherwise, look up in DB.
    const db = FOOD_DB[food.name] || { 
      cal: parseFloat(food.manualCal) || 0, 
      protein: parseFloat(food.manualProtein) || 0, 
      carbs: parseFloat(food.manualCarbs) || 0, 
      fat: parseFloat(food.manualFat) || 0, 
      fiber: parseFloat(food.manualFiber) || 0 
    }
    const qty = parseFloat(food.quantity) || 1
    
    return {
      calories: acc.calories + (db.cal * qty),
      protein:  acc.protein  + (db.protein * qty),
      carbs:    acc.carbs    + (db.carbs * qty),
      fat:      acc.fat      + (db.fat * qty),
      fiber:    acc.fiber    + (db.fiber * qty),
    }
  }, { calories: 0, protein: 0, carbs: 0, fat: 0, fiber: 0 })

  // Round at the very end for better precision
  return {
    calories: Math.round(totals.calories),
    protein:  Math.round(totals.protein),
    carbs:    Math.round(totals.carbs),
    fat:      Math.round(totals.fat),
    fiber:    Math.round(totals.fiber),
  }
}

export const calculateTargets = (profile) => {
  const { weight, height, age, gender, goal, goes_to_gym, has_pcos } = profile
  let bmr = gender === 'female'
    ? 447.6 + (9.25 * weight) + (3.1 * height) - (4.33 * age)
    : 88.36 + (13.4 * weight) + (4.8 * height) - (5.7 * age)

  let tdee = bmr * (goes_to_gym ? 1.55 : 1.375)
  if (has_pcos) tdee *= 0.95

  let calories = goal === 'lose' ? tdee - 300 : goal === 'muscle' ? tdee + 200 : tdee
  let protein  = goal === 'muscle' ? weight * 1.8 : goal === 'lose' ? weight * 1.5 : weight * 1.2

  return {
    calories: Math.round(calories),
    protein:  Math.round(protein),
    carbs:    Math.round(calories * 0.45 / 4),
    fat:      Math.round(calories * 0.25 / 9),
    fiber:    25,
  }
}